<style>
    table, th, td {
      border: 1px solid black;
    }
    div {
      height: 100%;
      width: 50%;
      border-left: 2px solid black;
    }
    .window {
      height: 100%;
      width: 49%;
      position: fixed;
      z-index: 1;
      top: 0;
      overflow-x: hidden;
      padding-top: 20px;
      padding-left: 5px;
    }
    
    .left {
      left: 0;
    }
    
    .right {
      right: 0;
    }
    </style>

<html>
  <form id="mainForm">
  <div class="window left">
<p>Instructor Landing Page</p>
<p id="welcome" style="color:blue"></p>

<button type="button" id="newQuestion">New Question</button>
<button type="button" id="createExam">Create Exam</button>
<button type="button" id="viewExam">View Exams</button>
<button type="button" id="logout">Logout</button>

<fieldset>Status:<p id="statusField"></p></fieldset>
<fieldset>Information:<p id="field1"></p></fieldset>
<fieldset>Operation:<p id="field2"></p></fieldset>

</div>
</form>

<div class="window right">
    <p>Question Bank:</p><br>
      Topic: <select id="sortTopic" name="sortTopic">
        <option value="none">none</option>
        <option value="if">if</option>
        <option value="loop">loop</option>
        <option value="arithmatic">arithmatic</option>
        <option value="lists">lists</option>
        <option value="strings">strings</option>
      </select>
      Difficulty: <select id="sortDiff" name="sortDiff">
          <option value="none">none</option>
          <option value="easy">easy</option>
          <option value="medium">medium</option>
          <option value="hard">hard</option>
        </select>
      Search: <input type="text" id="sortString" name="sortString">
      <button id="sortQuestion" type="button">Filter</button>
      <br>
      <br>
      <fieldset><p id="qField"></p></fieldset>
</div>
</html>

<script type="text/javascript">


//-------------------- Event Listeners -------------------------
var newQ = document.getElementById("newQuestion");
if(newQ){
  newQ.addEventListener("click", newQuestion);
};

var createE = document.getElementById("createExam");
if(createE){
  createE.addEventListener("click", createExam);
  };

var viewE = document.getElementById("viewExam");
if(viewE){
  viewE.addEventListener("click", viewExam);
  };

var logoutF = document.getElementById("logout");
if(logoutF){
  logoutF.addEventListener("click", logout);
  };

var sortQ = document.getElementById("sortQuestion");
if (sortQ){
    sortQ.addEventListener("click", getQuestions);
  };


//------------- Globab Variables --------------------------------

var msg = "";
var getExamID = "";
var getQuestionID = [];

//------------- Main Functions ----------------------------------

function createExam(){
  console.log("Create Exam Button Click");
  document.getElementById("statusField").innerHTML = '';
  document.getElementById("field1").innerHTML = 'Please enter the following: 1] Exam name. 2] Add question to the exam from the question bank. 3] Select the points each question are worth.';
  document.getElementById("field2").innerHTML = '\
  <h2>Create Exam</h2>\
  <br>\
  <label>Exam Name:</label>\
  <input type="text" id="examName">\
  <br>\
  <br>\
  <button id="submitExam" type="button">Submit</button>';

  var submitE = document.getElementById("submitExam");
      submitE.addEventListener("click", function() {msg = "CreateExam"; submit(setResp);});
};

function viewExam(){
  console.log("View Exam Button Click");
};

function logout(){
  console.log("Logout Button Click");
  window.location.href = "index.html";
};

function newQuestion(){
  console.log("New Question Button Click");
  document.getElementById("statusField").innerHTML = ''; 
  document.getElementById("field1").innerHTML = 'Please enter the following: 1] Function name. 2] Description. 3] Difficulty. 4] Topic. 5] Test Cases 1 and 2.';
  document.getElementById("field2").innerHTML = '\
        <label>Function Name:</label>\
        <input type="text" name="functionName">\
        <br>\
        <label>Description:</label>\
        <br>\
        <textarea name="functionDesc" rows="8" cols="40"></textarea>\
        <br>\
        <label>Difficulty:</label>\
        <select name="functionDiff">\
          <option value="easy">Easy</option>\
          <option value="medium">Medium</option>\
          <option value="hard">Hard</option>\
        </select>\
        <label>Topic:</label>\
        <select name="functionTopic">\
          <option value="if">if</option>\
          <option value="loop">loop</option>\
          <option value="arithmatic">arithmatic</option>\
        </select>\
        <br>\
        <br>\
        <label>Test Case 1:</label>\
        <input type="text" name="testCase1">\
        <br>\
        <label>Test Case 2:</label>\
        <input type="text" name="testCase2">\
        <br>\
        <br>\
        <button id="submitQuestion" type="button">Submit</button>';

      var submitQ = document.getElementById("submitQuestion");
      submitQ.addEventListener("click", function() {msg = "CreateQuestion"; submit(addQuestion);});
    };

    function addQuestion(statusJSON){
      console.log("submit question");
      document.getElementById("field2").innerHTML = statusJSON.response;
      getQuestions();
    };

//---------------------- Question Bank function --------------------
function getQuestions(){
      msg = "";
      submit(generateQB);
    };

function generateQB(){
  var sortTopic = document.getElementById("sortTopic").value;
  var sortDiff = document.getElementById("sortDiff").value;
  var sortString = document.getElementById("sortString").value;
  var i, x = "", qname = "", qdiff = "", qtopic = "", qdesc = "",
         qtc1 = "", qtc2 = "";
    for(i=0; i<statusJSON.length; i++){
        qname = statusJSON[i][0].question;
        qdiff = statusJSON[i][1].difficulty;
        qtopic = statusJSON[i][2].topic;
        qdesc = statusJSON[i][3].description;
        qtc1 = statusJSON[i][4].testCase1;
        qtc2 = statusJSON[i][5].testCase2;

        if((sortDiff == qdiff || sortDiff == "none") && (qtopic.includes(sortTopic) || 
        sortTopic == "none") && (desc.includes(sortString) || sortString == "")){
        x += '<fieldset id="qBank' + i + '"><button type="button" onclick="addQuestion(qBank' + i + ')">Add</button>\
          <b>Function Name: </b>' + qname + '<b> Topic: </b>' + qtopic + '<br>\
          <b> Test Cases: </b>' + qtc1 + '<input type="text" name="qname[]" value=' + qtc2 + ' hidden><br><b>Points: </b>\
          <input type="number" name="pts[]" oninput="totalPoints()"><br>' + '<b>Description: </b>' + qdiff + '<br>' + qdesc + '<br>\
          <br></fieldset>';
        }
      document.getElementById("qField").innerHTML = x;
    }
  }
    
    function addQuestion(fields){
      fields.removeChild(fields.childNodes[0]);
      document.getElementById("field2").appendChild(fields);
    }
    
    function totalPoints(){
      var i, x = 0;
      var pt = document.getElementsByName('pts[]');
      for(i=0; i<pt.length;i++){
        x += Number(pt[i].value);
      }
      document.getElementById("totalPoints").innerHTML = x;
    }

//---------------------- Response function -------------------------

function setResp(statusJSON){
      if(statusJSON.response){
        document.getElementById("statusField").innerHTML = statusJSON.response;
      }
      else{
        document.getElementById("statusField").innerHTML = statusJSON;
      }
  }
  
//---------------------- AJAX function -----------------------------
function submit(cFunction){

var fields = document.querySelector("form");
      console.log(msg);
      fields.append("", msg);

      if(msg == "CreateQuestion"){
        console.log("Question Created");
      }

      for(var pair of fields.entries()){
        console.log(pair[0]+ ', '+ pair[1]);
      }
      
      var xhr = new XMLHttpRequest();
        
      xhr.onreadystatechange = function() {
        if(xhr.readyState == 4 && xhr.status == 200) {
          statusJSON = JSON.parse(xhr.responseText);
          console.log(statusJSON);
          cFunction(statusJSON);
      }
    };
      
      xhr.open("POST", "curlhandler.php", true);
      xhr.send(new FormData(fields));
    
  };
    
   getQuestions();
   console.log("questionBank Generation")

</script>
